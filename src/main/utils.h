

#ifndef UTILS_H_
#define UTILS_H_

#include "interfaces.h"

struct Utils {
      
    static double getFrequency(I::Note note) {
        return I::Frequency[note];
    }

    static float calcGain(float value) {
        //float val = powf((100.f - value),2);
        //return (200.f - value);
            
    
        return value;
    }

};


struct AudioProcessor {
    const static int ringCount = 12;
    const static int bSize = 50;
    float circularBuffer[ringCount][bSize] = {{0}};
    float rtotal[ringCount] = {0};
    int bindex = 0;

    const float s = 1.f / bSize;

    float smoothen(int index, float value) {
        if (index == 0) {
            bindex = (bindex + 1) % bSize;
        }

        rtotal[index] -= circularBuffer[index][bindex];
        circularBuffer[index][bindex] = value;
        rtotal[index] += value;

        return (rtotal[index] * s);
    }
};







const int16_t myWaveform[256] = {
     0,  1895,  3748,  5545,  7278,  8934, 10506, 11984, 13362, 14634,
   15794, 16840, 17769, 18580, 19274, 19853, 20319, 20678, 20933, 21093,
   21163, 21153, 21072, 20927, 20731, 20492, 20221, 19929, 19625, 19320,
   19022, 18741, 18486, 18263, 18080, 17942, 17853, 17819, 17841, 17920,
   18058, 18254, 18507, 18813, 19170, 19573, 20017, 20497, 21006, 21538,
   22085, 22642, 23200, 23753, 24294, 24816, 25314, 25781, 26212, 26604,
   26953, 27256, 27511, 27718, 27876, 27986, 28049, 28068, 28047, 27989,
   27899, 27782, 27644, 27490, 27326, 27159, 26996, 26841, 26701, 26582,
   26487, 26423, 26392, 26397, 26441, 26525, 26649, 26812, 27012, 27248,
   27514, 27808, 28122, 28451, 28787, 29124, 29451, 29762, 30045, 30293,
   30495, 30643, 30727, 30738, 30667, 30509, 30254, 29897, 29433, 28858,
   28169, 27363, 26441, 25403, 24251, 22988, 21620, 20150, 18587, 16939,
   15214, 13423, 11577,  9686,  7763,  5820,  3870,  1926,     0, -1895,
   -3748, -5545, -7278, -8934,-10506,-11984,-13362,-14634,-15794,-16840,
  -17769,-18580,-19274,-19853,-20319,-20678,-20933,-21093,-21163,-21153,
  -21072,-20927,-20731,-20492,-20221,-19929,-19625,-19320,-19022,-18741,
  -18486,-18263,-18080,-17942,-17853,-17819,-17841,-17920,-18058,-18254,
  -18507,-18813,-19170,-19573,-20017,-20497,-21006,-21538,-22085,-22642,
  -23200,-23753,-24294,-24816,-25314,-25781,-26212,-26604,-26953,-27256,
  -27511,-27718,-27876,-27986,-28049,-28068,-28047,-27989,-27899,-27782,
  -27644,-27490,-27326,-27159,-26996,-26841,-26701,-26582,-26487,-26423,
  -26392,-26397,-26441,-26525,-26649,-26812,-27012,-27248,-27514,-27808,
  -28122,-28451,-28787,-29124,-29451,-29762,-30045,-30293,-30495,-30643,
  -30727,-30738,-30667,-30509,-30254,-29897,-29433,-28858,-28169,-27363,
  -26441,-25403,-24251,-22988,-21620,-20150,-18587,-16939,-15214,-13423,
  -11577, -9686, -7763, -5820, -3870, -1926
};


enum Note {
    NONE =  0,
    C0  =  1,
    Cs0 =   2,
    Db0 = 2,
    D0  =   3,
    Ds0 =   4,
    Eb0 = 4,
    E0  =   5,
    F0  =   6,
    Fs0 =   7,
    Gb0 = 7,
    G0  = 8,
    Gs0 = 9,
    Ab0 = 9,
    A_0 =   10,
    As0 = 11,
    Bb0 = 11,
    B_0 =   12,
    C1  =   13,
    Cs1 = 14,
    Db1 = 14,
    D1  = 15,
    Ds1 = 16, 
    Eb1 = 16,
    E1  = 17,
    F1  = 18,
    Fs1 = 19, 
    Gb1 = 19,
    G1  =   20,
    Gs1 = 21, 
    Ab1 = 21,
    A_1  =   22,
    As1 = 23, 
    Bb1 = 23,
    B_1  =  24,
    C2  = 25,
    Cs2 = 26, 
    Db2 = 26,
    D2  = 27,
    Ds2 = 28, 
    Eb2 = 28,
    E2  = 29,
    F2  = 30,
    Fs2 = 31, 
    Gb2 = 31,
    G2  =   32,
    Gs2 = 33, 
    Ab2 = 34,
    A_2  =   35,
    As2 = 36, 
    Bb2 = 36,
    B_2  =  37,
    C3  = 38,
    Cs3 = 39, 
    Db3 = 39,
    D3  = 40,
    Ds3 = 41, 
    Eb3 = 41,
    E3  = 42,
    F3  = 43,
    Fs3 =   44,
    Gb3 =   44,
    G3  =   45,
    Gs3 = 46, 
    Ab3 = 46,
    A_3  =   47,
    As3 = 48, 
    Bb3 = 48,
    B_3  =  49,
    C4  = 50,
    Cs4 = 51, 
    Db4 = 51,
    D4  = 52,
    Ds4 = 53, 
    Eb4 = 53,
    E4  = 54,
    F4  = 55,
    Fs4 = 56, 
    Gb4 = 56,
    G4  =   57,
    Gs4 = 58, 
    Ab4 = 58,
    A_4  =   59,
    As4 = 60, 
    Bb4 = 60,
    B_4  =  61,
    C5  = 62,
    Cs5 = 63, 
    Db5 = 63,
    D5  = 64,
    Ds5 = 65, 
    Eb5 = 65,
    E5  = 66,
    F5  = 67,
    Fs5 = 68, 
    Gb5 = 68,
    G5  = 69,
    Gs5 = 70, 
    Ab5 = 70,
    A_5  =   71,
    As5 = 72, 
    Bb5 = 72,
    B_5  =  73,
    C6  = 74,
    Cs6 = 75, 
    Db6 = 75,
    D6  = 76,
    Ds6 = 77, 
    Eb6 = 77,
    E6  = 78,
    F6  = 79,
    Fs6 = 80, 
    Gb6 = 80,
    G6  = 81,
    Gs6 = 82, 
    Ab6 = 82,
    A_6  =   83,
    As6 = 84, 
    Bb6 = 84,
    B_6  =  85,
    C7  =   86,
    Cs7 = 87, 
    Db7 = 87,
    D7  = 88,
    Ds7 = 89, 
    Eb7 = 89,
    E7  =   90,
    F7  = 91,
    Fs7 = 92, 
    Gb7 = 92,
    G7  = 93,
    Gs7 = 94, 
    Ab7 = 94,
    A_7  =   95,
    As7 = 96, 
    Bb7 = 96,
    B_7  =  97,
    C8  = 98,
    Cs8 = 99, 
    Db8 = 99,
    D8  = 100,
    Ds8 = 101, 
    Eb8 = 101,
    E8  = 102,
    F8  = 103,
    Fs8 = 104,
    Gb8 = 104,
    G8  = 105,
    Gs8 = 106,
    Ab8 = 106,
    A_8  =   107,
    As8 =   108,
    Bb8 = 108,
    B_8  =  109, 
};
  
constexpr static double Frequency[110] = {
    0,
    16.35,
    17.32,
    18.35,
    19.45,
    20.6,
    21.83,
    23.12,
    24.5,
    25.96,
    27.5,
    29.14,
    30.87,
    32.7,
    34.65,
    36.71,
    38.89,
    41.2,
    43.65,
    46.25,
    49,
    51.91,
    55,
    58.27,
    61.74,
    65.41,
    69.3,
    73.42,
    77.78,
    82.41,
    87.31,
    92.5,
    98,
    103.83,
    110,
    116.54,
    123.47,
    130.81,
    138.59,
    146.83,
    155.56,
    164.81,
    174.61,
    185,
    196,
    207.65,
    220,
    233.08,
    246.94,
    261.63,
    277.18,
    293.66,
    311.13,
    329.63,
    349.23,
    369.99,
    392,
    415.3,
    440,
    466.16,
    493.88,
    523.25,
    554.37,
    587.33,
    622.25,
    659.25,
    698.46,
    739.99,
    783.99,
    830.61,
    880,
    932.33,
    987.77,
    1046.5,
    1108.73,
    1174.66,
    1244.51,
    1318.51,
    1396.91,
    1479.98,
    1567.98,
    1661.22,
    1760,
    1864.66,
    1975.53,
    2093,
    2217.46,
    2349.32,
    2489.02,
    2637.02,
    2793.83,
    2959.96,
    3135.96,
    3322.44,
    3520,
    3729.31,
    3951.07,
    4186.01,
    4434.92,
    4698.63,
    4978.03,
    5274.04,
    5587.65,
    5919.91,
    6271.93,
    6644.88,
    7040,
    7458.62,
    7902.13 
};


const Note scale2[CHANNEL_NUM] = {
    E4, F4, Fs4, 
    Cs4, D4, Ds4, 
    C4, B_3, As3, //reverse!
    G3, Gs3, A_3
};

const Note scale1[CHANNEL_NUM] = {
    As3, D4, Fs4, 
    A_3, Cs4, F4, 
    E4, C4, Gs3,
    G3, B_3, Ds4
};

const Note scale[CHANNEL_NUM] = {
    As4, D5, Fs5, 
    A_4, Cs5, F5, 
    E5, C5, Gs4,
    G4, B_4, Ds5
};

#endif
